<!DOCTYPE html>
<html lang="en">
	<head>
    <link href="https://fonts.googleapis.com/css2?family=Six+Caps&display=swap" rel="stylesheet">
		<meta charset="utf-8">
		<title>Portfolio Vale Alvarez</title>
		<link rel="stylesheet" href="Public/index.css">
    <link rel="preload" href="Images/CocinaDiaVideo.mp4" as="video" type="video/mp4">
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@v0.163.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@v0.163.0/examples/jsm/"
        }
      }
    </script>
	</head>
    <body id="top">
      <!-- Overlay aviso orientación -->
      <div id="rotateMessage">
        <div class="message-box">
          <div class="phone-icon">
            <div class="phone"></div>
            <div class="screen"></div>
          </div>
          <p>For a better experience, rotate your device or zoom out the page (Ctrl -).</p>
        </div>
      </div>
       <div id="page-wrapper">
      <!-- Pantalla de carga -->
       <div id="preloader">
        <div class="loader"> </div>
        <div id="progress-text">Loading Portfolio... 0%</div>
      </div>
      <div class="Fondo-Inicio">
        <video id="themeVideo" autoplay loop muted playsinline>
          <source src="Images/CocinaNocheVideo.mp4" type="video/mp4">
          <!-- Fallback: imagen si no soporta video -->
          <img src="Images/imagennoche.png" alt="Noche de fondo">
        </video>
        <img src="Images/3dartist.png" class="threedartist">
        <img src="Images/PortfoliTitle.png" class="Titul">
        <img src="Images/OTitle.png" class="Titulo">
        <img src="Images/Sol.png" class = LunaSol id="themeToggle">
        <div class="About-Me">
          <img src="Images/1.jpg" class="SobremiText">
          <div class="contenedor-blender">
            <img src="Images/BlenderLogo.png" class="Blender">
            <img src="Images/CuatroEstrellas.png" class="estrellas-Blender">
            <img src="Images/habilidadesBlender.png" class="habilidades-Blender">
          </div>
          <div class="contenedor-substance">
            <img src="Images/Substance.png" class="Substance">
            <img src="Images/CuatroEstrellas.png" class="estrellas-Substance">
            <img src="Images/habilidadesSubstance.png" class="habilidades-Substance">
          </div>
          <div class="contenedor-Clip">
            <img src="Images/Clip.png" class="Clip">
            <img src="Images/CuatroEstrellas.png" class="estrellas-Clip">
            <img src="Images/habilidadesClip.png" class="habilidades-Clip">
          </div>
          <img src="Images/2.jpg" class="Echoes1">
          <img src="Images/3.jpg" class="EchoesTitle">
          <div class="video-container-echoes">
            <iframe 
              src="https://www.youtube.com/embed/_k2y8_AW4do" 
              title="YouTube video"
              frameborder="0" 
              allow="encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen>
            </iframe>
          </div>
          <video class="mi-video" autoplay loop muted playsinline>
            <source src="Cabrera.webm" type="video/webm">
            Tu navegador no soporta video transparente.
          </video>
          <video class="mi-videochime" autoplay loop muted playsinline>
            <source src="SillaVale.webm" type="video/webm">
            Tu navegador no soporta video transparente.
          </video>
          <img src="Images/4.jpg" class="Echoes2">
          <img src="Images/5.jpg" class="Echoes3">
          <img src="Images/6.jpg" class="Echoes4">

          <img src="Images/7.jpg" class="Nox1">
          <img src="Images/8.jpg" class="Nox2">
          <div class="video-container">
            <iframe 
              src="https://www.youtube.com/embed/rsPubY8bLgo" 
              title="YouTube video"
              frameborder="0" 
              allow="encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen>
            </iframe>
          </div>
  </div>

    <footer class="site-footer">
      <a href="#top" class="footer-btn footer-name" title="Go up">
        Valeria Alvarez
      </a>
      <a href="mailto:valalvarios@gmail.com" class="footer-btn" title="Contact me">
        <i class="fas fa-envelope"></i>
      </a>
      <a href="Docs/CV_VALERIA ALVAREZ RIOS.pdf" class="footer-btn" title="Download my CV" download>
        <i class="fas fa-file-alt"></i>
      </a>
    </footer>

      <!-- Cargar Font Awesome para íconos -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

     <script>
      // Script mejorado para el comportamiento del footer
      document.addEventListener("DOMContentLoaded", () => {
        const footer = document.querySelector(".site-footer");
        if (!footer) return;

        const nearBottomThreshold = 200; 
        const minScrolledToTriggerOnUp = 100; 
        let lastScroll = window.pageYOffset || 0;
        let footerTimeout = null;

        function handleScroll() {
          const currentScroll = window.pageYOffset || 0;
          const scrolledDownEnough = currentScroll > minScrolledToTriggerOnUp;
          const nearBottom = (currentScroll + window.innerHeight) >= (document.documentElement.scrollHeight - nearBottomThreshold);

          // Limpiar timeout anterior si existe
          if (footerTimeout) {
            clearTimeout(footerTimeout);
          }
          
          if (nearBottom) {
            footer.classList.add("visible");
          }
          else if (currentScroll < lastScroll && scrolledDownEnough) {
            footer.classList.add("visible");
            // Ocultar después de 3 segundos si no hay más interacción
            footerTimeout = setTimeout(() => {
              if (!nearBottom) footer.classList.remove("visible");
            }, 3000);
          } else {
            footer.classList.remove("visible");
          }

          lastScroll = currentScroll;
        }

        // Mostrar footer al hacer hover
        footer.addEventListener("mouseenter", () => {
          if (footerTimeout) clearTimeout(footerTimeout);
          footer.classList.add("visible");
        });

        // Ocultar después de salir del footer (con retraso)
        footer.addEventListener("mouseleave", () => {
          const currentScroll = window.pageYOffset || 0;
          const nearBottom = (currentScroll + window.innerHeight) >= (document.documentElement.scrollHeight - nearBottomThreshold);
          
          if (!nearBottom) {
            footerTimeout = setTimeout(() => {
              footer.classList.remove("visible");
            }, 1000);
          }
        });

        window.addEventListener("scroll", handleScroll, { passive: true });
        handleScroll();
      });
      </script>

      <script>
        // Script mejorado para cambiar entre temas
        const toggleBtn = document.getElementById("themeToggle");
        const themeImage = document.getElementById("themeVideo");

        // Precargar ambos videos para transiciones suaves
        const dayVideo = new Video();
        dayVideo.src = "Images/CocinaDiaVideo.mp4";
        dayVideo.preload = "auto";
        
        const nightVideo = new Video();
        nightVideo.src = "Images/CocinaNocheVideo.mp4";
        nightVideo.preload = "auto";

        function cambiarVideoSuave(videoElement, newSrc, duracion = 500) {
          return new Promise((resolve) => {
            const tiempoActual = videoElement.currentTime;
            videoElement.style.transition = `opacity ${duracion}ms ease-in-out`;
            videoElement.style.opacity = 0;

            setTimeout(() => {
              videoElement.querySelector("source").src = newSrc;
              videoElement.load();

              videoElement.onloadeddata = () => {
                const nuevoTiempo = Math.min(tiempoActual, videoElement.duration || tiempoActual);
                videoElement.currentTime = nuevoTiempo;
                videoElement.play();
                videoElement.style.opacity = 1;
                resolve();
              };
              
              videoElement.onerror = () => {
                videoElement.style.opacity = 1;
                resolve();
              };
            }, duracion);
          });
        }

        let darkMode = false;

        toggleBtn.addEventListener("click", async () => {
          // Deshabilitar múltiples clics durante la transición
          toggleBtn.style.pointerEvents = "none";
          
          darkMode = !darkMode;

          if (darkMode) {
            toggleBtn.src = "Images/Luna.png";
            await cambiarVideoSuave(themeVideo, "Images/CocinaDiaVideo.mp4");
          } else {
            toggleBtn.src = "Images/Sol.png";
            await cambiarVideoSuave(themeVideo, "Images/CocinaNocheVideo.mp4");
          }
          
          // Rehabilitar clics después de la transición
          setTimeout(() => {
            toggleBtn.style.pointerEvents = "auto";
          }, 500);
        });
      </script>

     <script>
      // Script mejorado para carga progresiva de recursos
      function waitForVideo(videoElement) {
        return new Promise(resolve => {
          if (videoElement.readyState >= 3) {
            resolve();
          } else {
            videoElement.addEventListener("canplaythrough", resolve, { once: true });
            videoElement.addEventListener("error", resolve); // Manejar errores
          }
        });
      }

      function waitForImage(src) {
        return new Promise(resolve => {
          const img = new Image();
          img.onload = () => resolve({success: true, src});
          img.onerror = () => resolve({success: false, src});
          img.src = src;
        });
      }

      // Función para cargar recursos en lotes con delay
      function loadInBatches(items, batchSize, delay) {
        const results = [];
        let index = 0;
        
        return new Promise(async (resolve) => {
          while (index < items.length) {
            const batch = items.slice(index, index + batchSize);
            index += batchSize;
            
            const batchPromises = batch.map(item => waitForImage(item));
            const batchResults = await Promise.all(batchPromises);
            results.push(...batchResults);
            
            // Esperar antes del siguiente lote
            if (index < items.length) {
              await new Promise(r => setTimeout(r, delay));
            }
          }
          resolve(results);
        });
      }

      async function preloadResources() {
        const videoNoche = document.getElementById("themeVideo");
        const videoDia = document.createElement("video");
        videoDia.src = "Images/CocinaDiaVideo.mp4";
        videoDia.preload = "auto";

        // Lista de todas las imágenes
        const images = [
          "Images/imagennoche.png",
          "Images/3dartist.png",
          "Images/PortfoliTitle.png",
          "Images/OTitle.png",
          "Images/Sol.png",
          "Images/Luna.png",
          "Images/BlenderLogo.png",
          "Images/CuatroEstrellas.png",
          "Images/habilidadesBlender.png",
          "Images/Substance.png",
          "Images/habilidadesSubstance.png",
          "Images/Clip.png",
          "Images/habilidadesClip.png",
          "Images/1.jpg",
          "Images/2.jpg",
          "Images/3.jpg",
          "Images/4.jpg",
          "Images/5.jpg",
          "Images/6.jpg",
          "Images/7.jpg",
          "Images/8.jpg"
        ];

        // Primero cargar videos
        const videoPromises = [
          waitForVideo(videoNoche),
          waitForVideo(videoDia)
        ];

        let loaded = 0;
        const total = images.length + videoPromises.length;
        const progressText = document.getElementById("progress-text");

        // Actualizar progreso para videos
        const trackedVideoPromises = videoPromises.map(promise =>
          promise.then(() => {
            loaded++;
            const percent = Math.round((loaded / total) * 100);
            progressText.textContent = `Loading Portfolio... ${percent}%`;
          })
        );

        await Promise.all(trackedVideoPromises);

        // Luego cargar imágenes en lotes de 3 con delay de 100ms
        await loadInBatches(images, 3, 100).then(imageResults => {
          imageResults.forEach((result, index) => {
            loaded++;
            const percent = Math.round((loaded / total) * 100);
            progressText.textContent = `Loading Portfolio... ${percent}%`;
            
            // Opcional: registrar imágenes que no cargaron
            if (!result.success) {
              console.warn(`Failed to load: ${result.src}`);
            }
          });
        });
      }

      window.addEventListener("load", async () => {
        const preloader = document.getElementById("preloader");
        
        try {
          await preloadResources();
          preloader.classList.add("hidden");
        } catch (error) {
          console.error("Error during preloading:", error);
          // Ocultar preloader incluso si hay errores
          setTimeout(() => {
            preloader.classList.add("hidden");
          }, 2000);
        }
      });
     </script>

      <script>
        // Script mejorado para detección de orientación en todos los dispositivos
        function checkScreenSize() {
          const rotateMessage = document.getElementById("rotateMessage");
          const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
          const isApple = /iPhone|iPad|iPod|Macintosh/i.test(navigator.userAgent);
          
          if (isMobile) {
            // Para dispositivos móviles, verificar orientación
            const isPortrait = window.innerHeight > window.innerWidth;
            
            if (isPortrait) {
              rotateMessage.style.display = "flex";
            } else {
              rotateMessage.style.display = "none";
            }
          } else if (isApple) {
            // Para dispositivos Apple no móviles, verificar ancho de pantalla
            if (window.innerWidth < 1200) {
              rotateMessage.style.display = "flex";
            } else {
              rotateMessage.style.display = "none";
            }
          } else {
            // Para otros dispositivos
            if (window.innerWidth < 1820) {
              rotateMessage.style.display = "flex";
            } else {
              rotateMessage.style.display = "none";
            }
          }
        }

        // Detectar cambios de orientación en dispositivos móviles
        function setupOrientationDetection() {
          // Verificar inicialmente
          checkScreenSize();
          
          // Para dispositivos que soportan orientationchange
          if (typeof window.orientation !== 'undefined') {
            window.addEventListener('orientationchange', checkScreenSize);
          }
          
          // Para todos los dispositivos
          window.addEventListener('resize', checkScreenSize);
        }

        window.addEventListener("load", setupOrientationDetection);
        window.addEventListener("resize", checkScreenSize);
      </script>

      <script type="module" src="./main.js"></script>
      <script src="golpe.js"></script>
    </body>
</html>